$(function(){$.fn.placeholder=function(){var a=$(this);setInterval(function(){a.each(function(){var c=$(this),b=$("#"+c.attr("for"));c.css("display",(b.data("forcePlaceholder")||($(document.body).data("focused")&&b.is(":not(:focus)")&&!b.val()))?"":"none")})},300)}});var isStupidIE=/MSIE (\d+\.\d+);/.test(navigator.userAgent);$(document).ready(function(){$(".b_submit_button").addClass("disabled").attr("disabled","disabled");var d=$("input[name='username'], input[name='login_username'], input[name='password']").data("forcePlaceholder",true);$(document.body).one("mousedown keydown",function(){$(document.body).data("focused",true);d.data("forcePlaceholder",false)});var l=window.location.search.substring(1);var e=1,A,c="",s=6,H=function(){if(!$(".cp_loginscreen-form__active input[name='username'], .cp_loginscreen-form__active input[name='login_username']").val()||($(document.body).data("focused")&&(!$(".cp_loginscreen-form__active input[name='password'], .cp_loginscreen-form__active input[name='secretkey']").val()||($(".cp_loginscreen-form__active input[name='captcha']").is(":visible")&&$(".cp_loginscreen-form__active input[name='captcha']").length&&!$(".cp_loginscreen-form__active input[name='captcha']").val())))||($(document.body).data("focused")&&$.active!==0)||$(".cp_loginscreen-form__active .b_submit_button").filter(".js-forced-disable").length||($("#captcha").is(":visible")&&!$("#captcha").val())){if(!$.active&&!n){$(".cp_loginscreen-form__active .b_submit_button").addClass("disabled").attr("disabled","disabled")}}else{if(!$.active&&!n){$(".cp_loginscreen-form__active .b_submit_button").removeClass("disabled").removeAttr("disabled")}d.data("forcePlaceholder",false)}},g=function(){if(!$("#sms_code").val()){$(".sms-form button").addClass("disabled").attr("disabled","disabled")}else{$(".sms-form button").removeClass("disabled").removeAttr("disabled")}},x=function(){if(!$("#forget_login").val()){$(".forget-form button").addClass("disabled").attr("disabled","disabled")}else{$(".forget-form button").removeClass("disabled").removeAttr("disabled")}},C=function(){var J=$("#new_pass"),L=J.val(),I=$("#new_pass_conf").val(),K=$(".forget-form-pass button").removeClass("disabled").removeAttr("disabled");if(J.get(0).pass_min_check||(L&&L==I)){h(J)}if(!L||!I||L!=I||J.get(0).pass_min_check){K.addClass("disabled").attr("disabled","disabled")}},B=function(I){var J=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Zа-яА-ЯёЁ\-0-9]+\.)+[a-zA-Zа-яА-ЯёЁ]{2,}))$/;return J.test(I)},i=function(O,N){var J=O.index(),K=$(".b_pmenu_wrap .b_pmenu_arrow");u=null;$(".b_pmenu_item").removeClass("b_pmenu_item-hover b_pmenu_item-active").eq(J).addClass("b_pmenu_item-hover b_pmenu_item-active");var M=O.offset().top-O.parent().offset().top;if(N){K.stop().animate({top:M},200)}else{K.css({top:M})}var L=$(".cp_loginscreen-form").removeClass("cp_loginscreen-form__active").filter("."+O.attr("id")).addClass("cp_loginscreen-form__active");H();$(".js-captcha-block").insertBefore(L.find(".js-restore-block"));if(L.attr("id")=="idFormLogin"){q()}else{w()}$(".js-extra-block").hide();var I=$(".js-"+O.attr("id")+"-extra-block");if(!I.length){return}I.show();if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){I.css("bottom",-I.height()).stop().animate({bottom:0},400)}},p=function(I){var J=I.val().length>=s;I.get(0).pass_min_check=!J;if(!J&&!$(".l_login_container.forget .error-alert:visible").length){$(".l_login_container.forget .error-alert").show().find(".error-alert-message").text(_t("Длина пароля должна быть не менее %s символов.").replace("%s",s));r($(".l_login_container.forget .l_login"))}else{if(J){$(".l_login_container.forget .error-alert").hide()}}return !J},h=function(I){validate_data=/^[a-zA-Z0-9]{8,30}$/.test(I.val());I.get(0).pass_min_check=!validate_data;if(!validate_data&&!$(".l_login_container.forget .error-alert:visible").length){$(".l_login_container.forget .error-alert").show().find(".error-alert-message").text(_t("В качестве пароля Вы можете иcпользовать комбинацию из 8-30 символов и состоящую из следующих знаков: A-Z, a-z, 0-9."));r($(".l_login_container.forget .l_login"))}else{if(validate_data){$(".l_login_container.forget .error-alert").hide()}}return validate_data};$(".b_input_text_placeholder").placeholder();if($(".l_login_container.remind").length){$(".l_login_container:not(.remind)").hide()}else{$(".l_login_container.forget").hide()}if($.browser.msie&&parseInt($.browser.version)<9){$(".b_checkbox").change(function(){setTimeout($.proxy(function(){if($(this).is(":checked:focus")){$(this).next("i").css({"background-position":"0 -57px"})}else{if($(this).is(":checked")){$(this).next("i").css({"background-position":"0 -38px"})}else{if($(this).is(":focus")){$(this).next("i").css({"background-position":"0 -19px"})}else{$(this).next("i").css({"background-position":"0 0"})}}}},this),20)})}$("a").attr("tabIndex","-1");$("form").each(function(){$(this).find("input[type='text'], input[type='password'], input[type='checkbox'], button").each(function(){$(this).attr("tabIndex",e++)})});A=$(".b_primary-menu > .b_pmenu_item");A.hover(function(){$(".b_pmenu_item").removeClass("b_pmenu_item-hover");$(this).addClass("b_pmenu_item-hover")}).click(function(I){$(".error-alert").hide();i($(this),I)});A.first().addClass("b_pmenu_item-first");A.last().addClass("b_pmenu_item-last");if(window.location.href.match(/partner\.timeweb\.ru/)){i($("#login_integ"))}else{if(window.location.href.match(/wm\.timeweb\.ru/)){i($("#login_master"))}else{if(window.location.href.match(/webmail|webtm|tw24|timeweb24|webmail2/)){i($("#login_webmail"))}else{if(window.location.href.match(/\:\/\/mail\./)){i($("#login_webmail"));$(".l_login_container").addClass("client")}else{i($("#login_hosting"))}}}}if(window.location.href.match(/webtm|tw24\.ru|timeweb24\.com|webmail2/)){$("#webMailForm").attr("action","https://"+window.location.host+"/src/redirect.php")}$(".forget-form, .forget-form-pass").find("input[type='password'], input[type='text']").keyup(function(L){if(L.keyCode===13){$(this).blur();var J=$("#new_pass"),K=J.val(),I=$("#new_pass_conf").val();if(J.get(0).pass_min_check||(K&&K==I)){if(h(J)){$(".b_submit_button:visible",$(this).parents(".forget-cp")).triggerHandler("click")}}}});$(".sms-form input[name='sms_code']").on("keyup",function(I){if(I.keyCode===13){$(this).blur();$(".b_submit_button:visible",$(this).parents(".sms-form")).triggerHandler("click")}});$(".b_primary-menu").mouseleave(function(){$(".b_pmenu_item").removeClass("b_pmenu_item-hover").filter(".b_pmenu_item-active").addClass("b_pmenu_item-hover")});if(window.error_login){$(".cp_loginscreen-form__active input.b_input_text[type='text']").attr("autocomplete","off").val(window.error_login).triggerHandler("blur")}var r=function(I){var K=200;var J=function(){if(!K){return}K=-K/1.5;K=Math.abs(K)<0.5?0:K;I.animate({"margin-left":K+"px"},50,false,J)};J()};var t=function(J,I){J.focus(function(){if(this.interval){clearInterval(this.interval)}this.interval=setInterval(function(){I()},200)}).blur(function(){if(this.interval){clearInterval(this.interval)}})};if($(".error-alert:visible").length){r($(".l_login"))}$(".b_link-restore").click(function(K){K.preventDefault();$(".error-alert").hide();if($(this).parents("#webMailForm").length&&l!="restorepassword"){$(".forget-cp").hide();$(".forget-webmail").show()}else{$(".forget-cp").show();$(".forget-webmail").hide();$(".forget-result").hide();$(".forget-form").css({visibility:"visible"}).find("input").val("")}$(".sms-form, .sms-title").hide();$(".forgot-title").show();if(l=="restorepassword"){j()}else{f()}var J=$("label.b_input_text_placeholder[for='forget_login']"),I=$(".forget-specified-options");if($(this).parents(".login_hosting, .login_vds").length){J.text(_t("Имя пользователя или домен"));I.text(_t("имя пользователя (или домен)"))}else{J.text(_t("Имя пользователя"));I.text(_t("имя пользователя"))}});var f=function(){$(".error-alert").hide();$(".l_login_container:not(.forget)").css({left:"0"}).animate({left:"-100%"},"fast",function(){$(this).hide()});$(".l_login_container.forget").show().css({left:"100%"}).animate({left:"0"},"fast")};var j=function(){$(".error-alert").hide();$(".l_login_container:not(.forget)").css({left:"-100%"});$(".l_login_container.forget").show().css({left:"0"})};if(l=="restorepassword"){$(".b_link-restore").triggerHandler("click")}var y=function(){l="";$(".error-alert").hide();$(".l_login_container.forget").animate({left:"100%"},"fast",function(){$(this).hide()});$(".l_login_container:not(.forget)").show().css({left:"-100%"}).animate({left:"0"},"fast")};var z=function(I){setTimeout($.proxy(function(){$(this).addClass("disabled").attr("disabled","disabled")},I),20)};$(".l_login_container:not(.forget) .b_submit_button").click(function(){z(this)});$(".l_login_container:not(.forget) form").keypress(function(I){if(I.keyCode===13){z($(".b_submit_button",this));if($.support.cors){setTimeout(function(){$("input:focus").blur()},20)}}});if($(".error-alert:visible").length){$("input[type='password']:visible").focus().val("")}$(".goto-auth").click(function(I){I.preventDefault();y();H();$(".b_submit_button").attr("disabled","disabled")});$(".forget .forget-form .b_submit_button").click(function(I){I.preventDefault();setTimeout(function(){$(".forget-form button").addClass("disabled").attr("disabled","disabled")},50);$.post(c+"/login.php",{action:"change_password",login:$("#forget_login").val(),email:$("#forget_email").val()},function(J){if($.trim(J)=="ok"){$(".forget-form").css({visibility:"hidden"});$(".forget-result").show();$(".l_login_container.forget .error-alert").hide()}else{if($.trim(J)=="empty"){v(_t("Аккаунта с таким именем пользователя или доменом не существует."))}else{if($.trim(J)=="bad_ip"){v(_t("Доступ с данного ip адреса запрещен."))}else{if($.trim(J)=="bad_country"){v(_t("Доступ для данной страны запрещен."))}else{v(_t("Ошибка восстановления пароля аккаунта. Повторите попытку позже."))}}}}})});var v=function(I){$(".l_login_container.forget .error-alert").show().find(".error-alert-message").text(I);r($(".l_login_container.forget .l_login"));$("#forget_login").focus()};$(".goto-forget-form ").click(function(I){I.preventDefault();$(".forget-result").hide();$(".forget-form").css({visibility:"visible"});$("#forget_login").focus()});t($("#forget_login, #forget_email"),x);H();$("#new_pass").blur(function(){h($(this))});t($("#new_pass, #new_pass_conf"),C);setInterval(q,900);setInterval(H,900);$(".forget-form-pass button").click(function(J){J.stopPropagation();var I=$("#new_pass").val();if(!I||I.length<s){return}$(this).addClass("disabled").attr("disabled","disabled").addClass("js-forced-disable");$.post(c+"/login.php",{action:"send_new_pass",p1:$("#new_pass").val()},function(K){if(K.status=="fail"){$(".l_login_container.forget .error-alert").show().find(".error-alert-message").text(_t("Ошибка. Проверьте правильность введенных данных."));r($(".l_login_container.forget .l_login"))}else{if(K.status=="sms_sent"){$(".cp_loginscreen-form__active .b_submit_button").removeClass("js-forced-disable");$(".forget-cp, .forget-webmail").hide();$(".sms-form").show();$(".forgot-title").hide();$(".sms-title").show()}else{window.location="/"}}},"json")});var k=50;function F(){setTimeout(function(){if(k>0){H();x();C();F();k--}},20)}F();t($("#sms_code"),g);$(".sms-form .b_submit_button").on("click",function(){var I=$(".cp_loginscreen-form__active").attr("action"),J=$(this);if(!$('input[name="sms_code"]').val()){return}J.addClass("disabled").addClass("js-forced-disable").attr("disabled","disabled");$.ajax({type:"post",url:I,dataType:"json",data:{sms_code:$('input[name="sms_code"]').val()}}).done(function(L,K,M){if(L.status=="ok"){window.location=I;return}else{if(L.status=="fail"){$(".error-alert-message").empty().append(L.error_text);$(".error-alert").show();r($(".l_login"));setTimeout(function(){$("input[type='password']:visible").focus().val("");H()},100);J.removeClass("disabled").removeAttr("disabled").removeClass("js-forced-disable")}}}).error(function(M,K,L){J.removeClass("disabled").removeAttr("disabled")})});function b(I){return false}function E(){return $(".js-captcha-img").length}function D(){if(!m()){return}var I=$(".js-captcha-img");if(!E()){var J=$($(".js-captcha-tpl").html().replace(/^\s*/).replace(/\s*$/));J.insertBefore($(".js-forms-cont form").filter(":visible").find(".js-restore-block")).show();I=$(".js-captcha-img");$(".b_input_text_placeholder",J).placeholder();t($("input[name='captcha']"),H)}I.clone().attr("src",I.attr("src").replace(/\?.*/,"")+"?"+Math.random()).hide().appendTo($(".js-captcha-cont")).load(function(){$(this).show()});I.remove();$("#captcha").val("")}var o=true;function w(){o=true;$(".js-captcha-block").hide()}var u="";var G="";var n=true;function q(K){var K=K||false;var L=$('[name="username"],[name="login_username"]',".cp_loginscreen-form__active");var J=L.val();if(!K&&u==J&&G==L.attr("name")){return}n=true;u=L.val();G=L.attr("name");var I=m();if(!I||!J){if(!I){n=false}w();return}o=false;a(J,function(M){n=false;if(o){return}if(!M){w();return}if(K||!$(".js-captcha-block").length){D()}$(".js-captcha-block").show()})}function m(){var I=$(".cp_loginscreen-form__active");return I.attr("id")=="idFormLogin"}function a(J,I){if(!m()){return false}I=I||function(){};$.ajax({type:"POST",url:"?ajax&method=ajax_is_captcha_need",data:{login:J},complete:function(K){I(!!(K.responseText*1))}})}$(".js-forms-cont").on("click",".js-captcha-refresh",D);$(".cp_loginscreen-form").on("submit",function(J,I){var N=this;var I=I||null;var S=$(this),K=S.serializeArray();if(S.prop("no_ajax_submit")=="Y"){return}J.preventDefault();K.push({name:"ajaxLogin",value:"Y"});var O=function(){S.prop("no_ajax_submit","Y");S.submit()};if(b($(this).attr("action"))){return O()}var M=function(U,T){U=U||_t("Ошибка входа");$(".error-alert-message").empty().append(U);$(".error-alert").show();r($(".l_login"));if(T){q();setTimeout(function(){$("input[name='captcha']:visible").focus();H()},100);return}setTimeout(function(){$("input[type='password']:visible").focus().val("");H()},100)};var R=null;for(var L=0;L<K.length;L++){if(K[L].name=="_show_form"){R=K[L].value;break}}if(R=="login_integ_master"&&!I){var P=arguments.callee;$.ajax({type:"POST",url:"?ajax&method=ajax_get_login_type",data:{login:$("#integrator-login").val(),pass:$("#integrator-password").val()},complete:function(T){var T=JSON.parse(T.responseText);if(!T||!T.type){return}P.call(N,J,T.type)},dataType:"jsonp"});return false}if(I){S.attr("action",I=="WEB"?S.attr("data-action-master"):S.attr("data-action-integ"))}var Q=$(this).attr("action");$.ajax({type:"POST",url:Q,data:K,dataType:"json",xhrFields:{withCredentials:$.support.cors},crossDomain:$.support.cors}).done(function(U,T,V){if(U.status=="ok"){if(!$.support.cors||isStupidIE){S.prop("no_ajax_submit","Y");S.submit();return}$(".cp_loginscreen-form__active .b_submit_button").addClass("js-forced-disable");window.location=S.attr("action");return false}$(".cp_loginscreen-form__active .b_submit_button").removeClass("js-forced-disable");if(U.status=="sms_sent"){$(".forget-cp, .forget-webmail").hide();$(".sms-form").show();$(".forgot-title").hide();$(".sms-title").show();f()}else{if(U.status=="fail"){q(true);M(U.error_text?U.error_text:(window.webMailErrors[U.error]?window.webMailErrors[U.error]:null),undefined!=U.error_alias&&U.error_alias=="invalidCaptcha")}}}).fail(function(V,T,U){$(".cp_loginscreen-form__active .b_submit_button").removeClass("js-forced-disable");q(true);M()});return false})});